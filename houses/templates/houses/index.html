{% include 'base.html' %}
 
{% block content %}
{% load static %}
<!--nav bar-->
<div class='navbar navbar-default navbar-static-top'>
  <div class='container-fluid'>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class='navbar-brand' href='index.html'>Searchable Map Template</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class='active'><a href="index.html">Map</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>

<!-- container -->
<div class='container-fluid'>
  <div class='row'>
    <div class='col-md-4'>
      <p>Searchable Map Template</a> using Google </p>
      <div class='well'>
        <h4>
          Address <small>(<a id='find_me' href='#'>find me</a>)</small>
        </h4>
        <p>
          <input class='form-control' id='search_address' placeholder='Enter an address or an intersection' type='text' />
        </p>
        <p>
          <label>
            within
            <select id='search_radius'>
              <option value='400'>a few blocks</option>
              <option value='1000'>about 2 kms</option>
              <option value='5000'>less than 5 kms</option>
              <option value='10000'>more than 5 kms</option>
            </select>
          </label>
        </p>
        <p>
            stuff
        </p>

        <br />
        <div class='row'>
          <div class='col-md-6'>
            stuff
          </div>
          <div class='col-md-6'>
            stuff 
          </div>
        </div>
        <br />
        <a class='btn btn-primary' id='search' href='#'>
          <i class='glyphicon glyphicon-search'></i>
          Search
        </a>
        <a class='btn btn-default' id='reset' href='#'>
          <i class='glyphicon glyphicon-repeat'></i>
          Reset
        </a>
      </div>
      <div class='alert alert-info' id='result_box' ><strong id='result_count'></strong></div>
    </div>
    <div class='col-md-8'>
      <noscript>
        <div class='alert alert-info'>
          <h4>Your JavaScript is disabled</h4>
          <p>Please enable JavaScript to view the map.</p>
        </div>
      </noscript>
      <div id='map_canvas'></div>
      <p class='pull-right'>
        <a href='#'>Searchable Map Template</a>.
    </p>
    </div>
  </div>
</div>

<!-- javascript -->
<script type="text/javascript" src="{% static 'js/jquery-1.12.4.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.address.js' %}"></script>
<script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?libraries=places&key=AIzaSyAjYIJDSpRo90YUDZNtLnSCTmuMHfLMAlo"></script>
<script type="text/javascript" src="{% static 'js/maps_lib.js' %}"></script>
<script type="text/javascript" src="{% static 'js/markerclusterer.js' %}"></script>
<script type='text/javascript'>
  //<![CDATA[
    $(window).resize(function () {
      var h = $(window).height(),
        offsetTop = 105; // Calculate the top offset
    
      $('#map_canvas').css('height', (h - offsetTop));
    }).resize();
    
    $(function() {
      var myLatLng = {lat: -1.2913472506516182  , lng: 36.82158678399196};
      var myMap = new google.maps.Map(document.getElementById('map_canvas'),{
          zoom: 10,
          center: myLatLng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
      });

      {% for house in houses %}
      var markers = new google.maps.Marker({
          position: new google.maps.LatLng('{{house.geolocation.lat}}', '{{house.geolocation.lon}}'),
          map: myMap,
          title: '{{house.name}}',
          url: '{% url "house_detail" house.slug %}'
          });
      {% endfor %}
      
      var autocomplete = new google.maps.places.Autocomplete(document.getElementById('search_address'));
  
      
      $('#search_radius').change(function(){
        myMap.doSearch();
      });
      
      $('#search').click(function(){
        myMap.doSearch();
      });
      
      $('#find_me').click(function(){
        myMap.findMe(); 
        return false;
      });
      
      $('#reset').click(function(){
        myMap.reset(); 
        return false;
      });
      
      $(":text").keydown(function(e){
          var key =  e.keyCode ? e.keyCode : e.which;
          if(key === 13) {
              $('#search').click();
              return false;
          }
      });
    });
  //]]>
</script>

{% endblock %}
    
  